<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <title>‡§∂‡•ç‡§∞‡•Ä ‡§¨‡§æ‡§≤‡§æ‡§ú‡•Ä ‡§µ‡•á‡§∞‡§æ‡§Ø‡§ü‡•Ä ‡§∏‡•ç‡§ü‡•ã‡§∞, ‡§ñ‡•Ç‡§°‡§º</title>
    
    <!-- Bootstrap 5 Minimal (‡§∏‡§ø‡§∞‡•ç‡§´ ‡§ú‡§∞‡•Ç‡§∞‡•Ä) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(145deg, #f0f9ff 0%, #dbeafe 100%);
            min-height: 100vh;
        }

        /* ===== LOGIN PAGE ===== */
        .login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            background: linear-gradient(135deg, #0284c7, #075985);
        }

        .login-card {
            background: white;
            border-radius: 32px;
            padding: 32px 24px;
            width: 100%;
            max-width: 380px;
            box-shadow: 0 20px 40px rgba(2, 132, 199, 0.3);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .store-icon {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, #0284c7, #0369a1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            box-shadow: 0 8px 16px rgba(2, 132, 199, 0.2);
        }

        .store-icon i {
            font-size: 42px;
            color: white;
        }

        .login-header h2 {
            font-size: 22px;
            font-weight: 700;
            color: #0c4a6e;
            line-height: 1.3;
        }
        
        .login-header h2 span {
            color: #0284c7;
            display: block;
            font-size: 18px;
            font-weight: 500;
        }

        .login-header p {
            color: #64748b;
            font-size: 13px;
            margin-top: 8px;
        }

        .input-group-custom {
            position: relative;
            margin-bottom: 16px;
        }

        .input-group-custom i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            font-size: 18px;
            z-index: 1;
        }

        .input-group-custom input {
            width: 100%;
            padding: 16px 16px 16px 50px;
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            font-size: 15px;
            background: white;
            transition: all 0.2s;
        }

        .input-group-custom input:focus {
            border-color: #0284c7;
            outline: none;
            box-shadow: 0 0 0 4px rgba(2, 132, 199, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #0284c7, #0369a1);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 17px;
            font-weight: 600;
            margin-top: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .login-btn:active {
            transform: scale(0.98);
        }

        .message {
            padding: 12px;
            border-radius: 16px;
            margin: 16px 0;
            text-align: center;
            font-weight: 500;
            font-size: 13px;
        }

        .error-message {
            background: #fee2e2;
            color: #dc2626;
        }

        .success-message {
            background: #dcfce7;
            color: #059669;
        }

        /* ===== DASHBOARD ===== */
        .dashboard {
            min-height: 100vh;
            background: #f0f9ff;
        }

        /* üî• FIXED NAVBAR - ‡§Ö‡§¨ perfect alignment */
        .mini-navbar {
            background: white;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(2, 132, 199, 0.1);
            gap: 8px;
        }

        .mini-brand {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .mini-brand i {
            font-size: 24px;
            color: #0284c7;
        }

        .brand-text {
            font-weight: 700;
            font-size: 16px;
            color: #0c4a6e;
            line-height: 1.2;
        }
        
        .brand-text small {
            display: block;
            font-size: 11px;
            font-weight: 400;
            color: #64748b;
        }

        .nav-icons {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: nowrap;
        }

        .recycle-icon {
            position: relative;
            width: 40px;
            height: 40px;
            background: #f1f5f9;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0284c7;
            text-decoration: none;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .recycle-icon:active {
            background: #e0f2fe;
            transform: scale(0.95);
        }

        .deleted-count {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #ef4444;
            color: white;
            font-size: 10px;
            min-width: 18px;
            height: 18px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
            font-weight: 600;
        }

        .admin-chip {
            background: #f1f5f9;
            padding: 6px 12px;
            border-radius: 30px;
            color: #0284c7;
            font-weight: 500;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .admin-chip i {
            color: #fbbf24;
            font-size: 12px;
        }

        .admin-chip span {
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .logout-btn {
            background: #f1f5f9;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .logout-btn:active {
            background: #fee2e2;
            color: #dc2626;
        }

        /* Main Container */
        .main-container {
            padding: 16px;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Total Dues Card */
        .total-dues-card {
            background: linear-gradient(135deg, #0284c7, #0369a1);
            border-radius: 28px;
            padding: 24px 20px;
            margin-bottom: 20px;
            color: white;
            box-shadow: 0 10px 20px rgba(2, 132, 199, 0.2);
        }

        .total-dues-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 6px;
            letter-spacing: 0.5px;
        }

        .total-dues-card .amount {
            font-size: 38px;
            font-weight: 700;
            margin-bottom: 4px;
            line-height: 1;
        }

        .total-dues-card .store-name {
            font-size: 12px;
            opacity: 0.8;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 18px;
            padding: 14px 4px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
            border: 1px solid rgba(2, 132, 199, 0.1);
        }

        .stat-card i {
            font-size: 22px;
            color: #0284c7;
            margin-bottom: 6px;
        }

        .stat-card .value {
            font-size: 18px;
            font-weight: 700;
            color: #0c4a6e;
            line-height: 1.2;
        }

        .stat-card .label {
            font-size: 10px;
            color: #64748b;
            line-height: 1.3;
        }

        /* üî• SEARCH BAR - PERFECT */
        .search-section {
            margin-bottom: 16px;
        }

        .search-wrapper {
            background: white;
            border-radius: 24px;
            padding: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.02);
            border: 1px solid rgba(2, 132, 199, 0.2);
            display: flex;
            align-items: center;
        }

        .search-wrapper:focus-within {
            border-color: #0284c7;
            box-shadow: 0 0 0 3px rgba(2, 132, 199, 0.1);
        }

        .search-icon {
            width: 44px;
            height: 44px;
            background: #f1f5f9;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0284c7;
            margin: 4px;
            flex-shrink: 0;
        }

        .search-wrapper input {
            flex: 1;
            padding: 10px 8px;
            border: none;
            font-size: 15px;
            background: transparent;
            min-width: 0;
        }

        .search-wrapper input::placeholder {
            color: #94a3b8;
        }

        .search-wrapper input:focus {
            outline: none;
        }

        .clear-search {
            width: 40px;
            height: 40px;
            background: #f1f5f9;
            border: none;
            border-radius: 16px;
            color: #64748b;
            margin-right: 6px;
            cursor: pointer;
            display: none;
            flex-shrink: 0;
        }

        .clear-search:active {
            background: #fee2e2;
            color: #dc2626;
        }

        .search-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding: 0 4px;
        }

        .search-count {
            background: #f1f5f9;
            padding: 5px 14px;
            border-radius: 30px;
            font-size: 12px;
            color: #0284c7;
            font-weight: 500;
        }

        .result-badge {
            background: #0284c7;
            color: white;
            padding: 5px 14px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 500;
            max-width: 180px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Add Customer Button */
        .add-btn {
            width: 100%;
            padding: 14px;
            background: white;
            border: 2px dashed #0284c7;
            border-radius: 24px;
            color: #0284c7;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 16px 0;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 15px;
        }

        .add-btn:active {
            background: #f0f9ff;
            border-style: solid;
            transform: scale(0.98);
        }

        .add-btn.hidden {
            display: none;
        }

        /* Customers Grid */
        .customers-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* üåà CUSTOMER CARDS */
        .customer-card {
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.02);
            transition: all 0.2s;
            animation: fadeIn 0.3s ease;
            border: 1px solid rgba(2, 132, 199, 0.1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .customer-card:active {
            transform: scale(0.99);
        }

        /* üé® 6 ‡§Ö‡§≤‡§ó-‡§Ö‡§≤‡§ó ‡§∞‡§Ç‡§ó */
        .customer-card[data-color="1"] { background: linear-gradient(145deg, #5996bf, #dbeafe); }
        .customer-card[data-color="2"] { background: linear-gradient(145deg, #e08289, #ffe4e6); }
        .customer-card[data-color="3"] { background: linear-gradient(145deg, #62c981, #dcfce7); }
        .customer-card[data-color="4"] { background: linear-gradient(145deg, #cbc36b, #fef08a); }
        .customer-card[data-color="5"] { background: linear-gradient(145deg, #975dd6, #e9d5ff); }
        .customer-card[data-color="6"] { background: linear-gradient(145deg, #dc969b, #fecaca); }

        .customer-header {
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .customer-avatar {
            width: 52px;
            height: 52px;
            background: white;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0284c7;
            font-size: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
            flex-shrink: 0;
        }

        .customer-info {
            flex: 1;
            min-width: 0;
        }

        .customer-name {
            font-size: 16px;
            font-weight: 600;
            color: #0c4a6e;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .customer-meta {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #334155;
            font-size: 12px;
            white-space: nowrap;
        }

        .meta-item i {
            color: #0284c7;
            font-size: 11px;
        }

        .due-badge {
            background: white;
            padding: 3px 10px;
            border-radius: 30px;
            color: #dc2626;
            font-weight: 600;
            font-size: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            white-space: nowrap;
        }

        /* Customer Actions */
        .customer-actions {
            display: flex;
            gap: 6px;
            padding: 12px 16px;
            background: rgba(255,255,255,0.5);
            border-top: 1px solid rgba(255,255,255,0.8);
            flex-wrap: wrap;
        }

        .action-btn {
            flex: 1;
            min-width: 80px;
            padding: 10px 6px;
            border: none;
            border-radius: 16px;
            font-weight: 500;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        .action-btn:active {
            transform: scale(0.96);
        }

        .whatsapp-btn {
            background: #25D366;
            color: white;
        }

        .edit-btn {
            background: #fbbf24;
            color: #0c4a6e;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
        }

        /* üåà PRODUCTS SECTION */
        .products-section {
            padding: 16px;
            background: rgba(255,255,255,0.3);
            border-top: 1px solid rgba(255,255,255,0.5);
        }

        .products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .products-header h5 {
            font-size: 14px;
            font-weight: 600;
            color: #0284c7;
            margin: 0;
        }

        .add-product-mini {
            background: white;
            color: #0284c7;
            border: none;
            padding: 5px 12px;
            border-radius: 30px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        .add-product-mini:active {
            background: #f1f5f9;
        }

        .product-item {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.8);
        }

        .product-item:active {
            transform: translateX(3px);
        }

        .product-name {
            font-weight: 600;
            color: #0c4a6e;
            font-size: 13px;
            margin-bottom: 3px;
        }

        .product-details {
            display: flex;
            gap: 10px;
            color: #334155;
            font-size: 11px;
        }

        .product-details i {
            color: #0284c7;
            margin-right: 2px;
        }

        .product-actions {
            display: flex;
            gap: 5px;
        }

        .product-actions button {
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background: white;
            color: #64748b;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-actions button:active {
            background: #f1f5f9;
            color: #0284c7;
        }

        .total-amount {
            background: white;
            padding: 12px;
            border-radius: 16px;
            margin-top: 12px;
            text-align: right;
            font-weight: 600;
            color: #0284c7;
            font-size: 13px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.02);
        }

        /* Search Highlight */
        .search-highlight {
            background: #fbbf24;
            color: #0c4a6e;
            padding: 2px 5px;
            border-radius: 6px;
            font-weight: 600;
        }

        /* Loading Spinner */
        .loading-spinner {
            text-align: center;
            padding: 40px 16px;
            background: white;
            border-radius: 24px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f1f5f9;
            border-top: 4px solid #0284c7;
            border-radius: 50%;
            margin: 0 auto 12px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 16px;
            background: white;
            border-radius: 24px;
        }

        .empty-state i {
            font-size: 48px;
            color: #e0f2fe;
            margin-bottom: 12px;
        }

        .empty-state h3 {
            color: #0c4a6e;
            margin-bottom: 6px;
            font-size: 17px;
        }

        .empty-state p {
            color: #64748b;
            font-size: 13px;
        }

        .hidden {
            display: none !important;
        }

        /* Mobile Optimizations */
        @media (max-width: 380px) {
            .brand-text {
                font-size: 14px;
            }
            
            .admin-chip span {
                max-width: 60px;
            }
            
            .stat-card {
                padding: 10px 2px;
            }
            
            .stat-card .value {
                font-size: 16px;
            }
            
            .stat-card .label {
                font-size: 9px;
            }
            
            .action-btn {
                font-size: 11px;
                padding: 8px 4px;
            }
            
            .customer-meta {
                gap: 6px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-page">
        <div class="login-card">
            <div class="login-header">
                <div class="store-icon">
                    <i class="fas fa-store"></i>
                </div>
                <h2>‡§∂‡•ç‡§∞‡•Ä ‡§¨‡§æ‡§≤‡§æ‡§ú‡•Ä <span>‡§µ‡•á‡§∞‡§æ‡§Ø‡§ü‡•Ä ‡§∏‡•ç‡§ü‡•ã‡§∞, ‡§ñ‡•Ç‡§°‡§º</span></h2>
                <p>‡§ï‡•á‡§µ‡§≤ ‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§è‡§°‡§Æ‡§ø‡§®</p>
            </div>

            <div id="messageContainer"></div>

            <div class="input-group-custom">
                <i class="fas fa-envelope"></i>
                <input type="email" id="emailInput" placeholder="‡§à‡§Æ‡•á‡§≤">
            </div>

            <div class="input-group-custom">
                <i class="fas fa-lock"></i>
                <input type="password" id="passwordInput" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°" onkeypress="handleKeyPress(event)">
            </div>

            <button class="login-btn" onclick="loginWithEmail()" id="loginBtn">
                ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç
            </button>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboardPage" class="dashboard hidden">
        <!-- Mini Navbar - FIXED -->
        <div class="mini-navbar">
            <div class="mini-brand">
                <i class="fas fa-store"></i>
                <div class="brand-text">
                    ‡§∂‡•ç‡§∞‡•Ä ‡§¨‡§æ‡§≤‡§æ‡§ú‡•Ä
                    <small>‡§µ‡•á‡§∞‡§æ‡§Ø‡§ü‡•Ä ‡§∏‡•ç‡§ü‡•ã‡§∞, ‡§ñ‡•Ç‡§°‡§º</small>
                </div>
            </div>
            
            <div class="nav-icons">
                <a href="recycle.html" class="recycle-icon" title="‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï">
                    <i class="fas fa-trash-alt"></i>
                    <span class="deleted-count" id="deletedCount">0</span>
                </a>
                
                <div class="admin-chip">
                    <i class="fas fa-crown"></i>
                    <span id="adminEmail"></span>
                </div>

                <button class="logout-btn" onclick="logout()" title="‡§≤‡•â‡§ó‡§Ü‡§â‡§ü">
                    <i class="fas fa-power-off"></i>
                </button>
            </div>
        </div>

        <!-- Main Container -->
        <div class="main-container">
            <!-- Total Dues -->
            <div class="total-dues-card">
                <h3>‡§ï‡•Å‡§≤ ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§æ‡§∂‡§ø</h3>
                <div class="amount" id="totalDues">‚Çπ0</div>
                <div class="store-name">‡§∂‡•ç‡§∞‡•Ä ‡§¨‡§æ‡§≤‡§æ‡§ú‡•Ä ‡§µ‡•á‡§∞‡§æ‡§Ø‡§ü‡•Ä ‡§∏‡•ç‡§ü‡•ã‡§∞, ‡§ñ‡•Ç‡§°‡§º</div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <div class="value" id="totalCustomers">0</div>
                    <div class="label">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div class="value" id="highDueCustomers">0</div>
                    <div class="label">‚Çπ500+</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-calculator"></i>
                    <div class="value" id="avgDue">‚Çπ0</div>
                    <div class="label">‡§î‡§∏‡§§</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-box"></i>
                    <div class="value" id="totalProducts">0</div>
                    <div class="label">‡§â‡§§‡•ç‡§™‡§æ‡§¶</div>
                </div>
            </div>

            <!-- üî• SEARCH BAR -->
            <div class="search-section">
                <div class="search-wrapper">
                    <div class="search-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <input type="text" id="searchInput" placeholder="‡§®‡§æ‡§Æ ‡§Ø‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞..." autocomplete="off">
                    <button class="clear-search" id="clearSearch" onclick="clearSearch()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="search-stats">
                    <span class="search-count" id="searchCount">0 ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï</span>
                    <span class="result-badge" id="resultBadge">‡§∏‡§≠‡•Ä ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï</span>
                </div>
            </div>

            <!-- Add Customer Button -->
            <button class="add-btn" id="addCustomerBtn" onclick="showAddCustomerModal()">
                <i class="fas fa-plus-circle"></i> ‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
            </button>

            <!-- Customers List -->
            <div id="customersList" class="customers-grid">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p>‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Modal -->
    <div class="modal fade" id="customerModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 24px;">
                <div class="modal-header" style="background: #0284c7; color: white; border: none; padding: 16px 20px;">
                    <h5 class="modal-title" id="customerModalTitle">
                        <i class="fas fa-user-plus"></i> ‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="padding: 20px;">
                    <input type="text" class="form-control" id="customerName" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ *" style="margin-bottom: 12px; border-radius: 16px; padding: 12px 16px;">
                    <input type="tel" class="form-control" id="customerPhone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ *" style="margin-bottom: 12px; border-radius: 16px; padding: 12px 16px;">
                    <input type="text" class="form-control" id="customerItem" placeholder="‡§∏‡§æ‡§Æ‡§æ‡§® (‡§®‡§è ‡§ï‡•á ‡§≤‡§ø‡§è)" style="margin-bottom: 12px; border-radius: 16px; padding: 12px 16px;">
                    <input type="number" class="form-control" id="customerPrice" placeholder="‡§ï‡•Ä‡§Æ‡§§ (‡§®‡§è ‡§ï‡•á ‡§≤‡§ø‡§è)" style="margin-bottom: 12px; border-radius: 16px; padding: 12px 16px;">
                    <input type="date" class="form-control" id="customerDate" style="border-radius: 16px; padding: 12px 16px;">
                    <small class="text-muted d-block mt-2">‡§è‡§°‡§ø‡§ü ‡§Æ‡•á‡§Ç ‡§∏‡§ø‡§∞‡•ç‡§´ ‡§®‡§æ‡§Æ-‡§´‡•ã‡§® ‡§¨‡§¶‡§≤‡•á‡§Ç</small>
                </div>
                <div class="modal-footer" style="padding: 16px 20px; border-top: 1px solid #f1f5f9;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 30px; padding: 10px 20px;">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                    <button type="button" class="btn" style="background: #0284c7; color: white; border-radius: 30px; padding: 10px 25px;" onclick="saveCustomer()">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div class="modal fade" id="productModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 24px;">
                <div class="modal-header" style="background: #0284c7; color: white; border: none; padding: 16px 20px;">
                    <h5 class="modal-title">
                        <i class="fas fa-box"></i> ‡§®‡§Ø‡§æ ‡§â‡§§‡•ç‡§™‡§æ‡§¶
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="padding: 20px;">
                    <input type="text" class="form-control" id="productName" placeholder="‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ï‡§æ ‡§®‡§æ‡§Æ *" style="margin-bottom: 12px; border-radius: 16px; padding: 12px 16px;">
                    <input type="number" class="form-control" id="productPrice" placeholder="‡§ï‡•Ä‡§Æ‡§§ (‚Çπ) *" style="margin-bottom: 12px; border-radius: 16px; padding: 12px 16px;">
                    <input type="date" class="form-control" id="productDate" style="border-radius: 16px; padding: 12px 16px;">
                </div>
                <div class="modal-footer" style="padding: 16px 20px; border-top: 1px solid #f1f5f9;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 30px; padding: 10px 20px;">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                    <button type="button" class="btn" style="background: #0284c7; color: white; border-radius: 30px; padding: 10px 25px;" onclick="saveProduct()">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDMO9CwYSF4tH4y3y0eD9IEaoYq1yIeP7g",
            authDomain: "shree-balaji-variety-store.firebaseapp.com",
            databaseURL: "https://shree-balaji-variety-store-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "shree-balaji-variety-store",
            storageBucket: "shree-balaji-variety-store.firebasestorage.app",
            messagingSenderId: "455588388635",
            appId: "1:455588388635:web:6958b0e092b7455d9a3dbe"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Global Variables
        let currentCustomerId = null;
        let allCustomers = [];
        let searchTimeout = null;

        // Auth State
        auth.onAuthStateChanged((user) => {
            if (user) {
                database.ref("admins/" + user.uid).once("value")
                    .then(snapshot => {
                        if (snapshot.exists()) {
                            document.getElementById('loginPage').classList.add('hidden');
                            document.getElementById('dashboardPage').classList.remove('hidden');
                            document.getElementById('adminEmail').innerHTML = user.email.split('@')[0];
                            loadCustomers();
                            loadDeletedCount();
                        } else {
                            auth.signOut();
                            showMessage('‚ùå ‡§Ü‡§™ ‡§è‡§°‡§Æ‡§ø‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç', 'error');
                        }
                    });
            } else {
                document.getElementById('loginPage').classList.remove('hidden');
                document.getElementById('dashboardPage').classList.add('hidden');
            }
        });

        // Load Deleted Count
        function loadDeletedCount() {
            database.ref('deleted_customers').once('value')
                .then(snapshot => {
                    const count = snapshot.exists() ? snapshot.numChildren() : 0;
                    document.getElementById('deletedCount').textContent = count;
                });
        }

        // Login
        function loginWithEmail() {
            const email = document.getElementById('emailInput').value.trim();
            const password = document.getElementById('passwordInput').value;
            const btn = document.getElementById('loginBtn');

            if (!email || !password) {
                showMessage('‚ùå ‡§à‡§Æ‡•á‡§≤ ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§°‡§æ‡§≤‡•á‡§Ç', 'error');
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '‡§≤‡•â‡§ó‡§ø‡§® ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...';

            auth.signInWithEmailAndPassword(email, password)
                .catch(error => showMessage('‚ùå ‡§≤‡•â‡§ó‡§ø‡§® ‡§µ‡§ø‡§´‡§≤: ' + error.message, 'error'))
                .finally(() => {
                    btn.disabled = false;
                    btn.innerHTML = '‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç';
                });
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') loginWithEmail();
        }

        function logout() {
            auth.signOut();
        }

        // Load Customers
        function loadCustomers() {
            database.ref('customers').on('value', (snapshot) => {
                allCustomers = [];
                let totalDues = 0, totalProducts = 0, highDueCount = 0;
                
                if (snapshot.exists()) {
                    snapshot.forEach(child => {
                        const customer = child.val();
                        customer.id = child.key;
                        
                        let customerTotal = 0;
                        if (customer.products) {
                            Object.values(customer.products).forEach(p => {
                                customerTotal += Number(p.price) || 0;
                                totalProducts++;
                            });
                        }
                        customer.totalDues = customerTotal;
                        if (customerTotal >= 500) highDueCount++;
                        allCustomers.push(customer);
                    });
                    
                    allCustomers.sort((a, b) => (a.name || '').localeCompare(b.name || ''));
                }
                
                totalDues = allCustomers.reduce((sum, c) => sum + (c.totalDues || 0), 0);
                document.getElementById('totalDues').innerHTML = `‚Çπ${totalDues}`;
                document.getElementById('totalCustomers').textContent = allCustomers.length;
                document.getElementById('highDueCustomers').textContent = highDueCount;
                document.getElementById('avgDue').innerHTML = allCustomers.length ? `‚Çπ${Math.round(totalDues/allCustomers.length)}` : '‚Çπ0';
                document.getElementById('totalProducts').textContent = totalProducts;
                
                displayCustomers(allCustomers);
            });
        }

        // SEARCH FUNCTION
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase().trim();
            const clearBtn = document.getElementById('clearSearch');
            const addBtn = document.getElementById('addCustomerBtn');
            
            clearBtn.style.display = query ? 'flex' : 'none';
            clearTimeout(searchTimeout);
            
            if (!query) {
                addBtn.classList.remove('hidden');
                displayCustomers(allCustomers);
                document.getElementById('searchCount').textContent = `${allCustomers.length} ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï`;
                document.getElementById('resultBadge').textContent = '‡§∏‡§≠‡•Ä ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï';
                return;
            }
            
            addBtn.classList.add('hidden');
            
            searchTimeout = setTimeout(() => {
                const filtered = allCustomers.filter(c => 
                    (c.name && c.name.toLowerCase().includes(query)) ||
                    (c.phone && c.phone.includes(query))
                );
                
                displayCustomers(filtered);
                document.getElementById('searchCount').textContent = `${filtered.length} ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§Æ‡§ø‡§≤‡•á`;
                document.getElementById('resultBadge').textContent = `"${e.target.value}"`;
            }, 300);
        });

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('clearSearch').style.display = 'none';
            document.getElementById('addCustomerBtn').classList.remove('hidden');
            displayCustomers(allCustomers);
            document.getElementById('searchCount').textContent = `${allCustomers.length} ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï`;
            document.getElementById('resultBadge').textContent = '‡§∏‡§≠‡•Ä ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï';
        }

        // Format Date in Hindi
        function formatDateHindi(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const day = date.getDate();
            const month = date.toLocaleString('hi-IN', { month: 'long' });
            const year = date.getFullYear();
            return `${day} ${month} ${year}`;
        }

        // Display Customers
        function displayCustomers(list) {
            const container = document.getElementById('customersList');
            
            if (list.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§π‡•Ä‡§Ç</h3>
                        <p>${document.getElementById('searchInput').value ? '‡§Ü‡§™‡§ï‡•Ä ‡§ñ‡•ã‡§ú ‡§∏‡•á ‡§Æ‡•á‡§≤ ‡§ñ‡§æ‡§§‡§æ ‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§π‡•Ä‡§Ç' : '‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç'}</p>
                    </div>
                `;
                return;
            }
            
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            
            container.innerHTML = '';
            list.forEach((c, index) => {
                const colorNum = (index % 6) + 1;
                
                let displayName = c.name || '‡§®‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç';
                let displayPhone = c.phone || '';
                
                if (query) {
                    const regex = new RegExp(`(${query})`, 'gi');
                    displayName = displayName.replace(regex, '<span class="search-highlight">$1</span>');
                    displayPhone = displayPhone.replace(regex, '<span class="search-highlight">$1</span>');
                }
                
                let productsHTML = '';
                if (c.products && Object.keys(c.products).length > 0) {
                    productsHTML = `
                        <div class="products-section">
                            <div class="products-header">
                                <h5><i class="fas fa-box"></i> ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§∏‡•Ç‡§ö‡•Ä</h5>
                                <button class="add-product-mini" onclick="event.stopPropagation(); showAddProductModal('${c.id}')">
                                    <i class="fas fa-plus"></i> ‡§®‡§Ø‡§æ
                                </button>
                            </div>
                    `;
                    
                    let total = 0;
                    let productIndex = 0;
                    Object.entries(c.products).forEach(([pid, p]) => {
                        total += Number(p.price);
                        productIndex++;
                        
                        productsHTML += `
                            <div class="product-item">
                                <div>
                                    <div class="product-name">${p.name}</div>
                                    <div class="product-details">
                                        <span><i class="fas fa-rupee-sign"></i> ${p.price}</span>
                                        <span><i class="far fa-calendar"></i> ${formatDateHindi(p.date)}</span>
                                    </div>
                                </div>
                                <div class="product-actions">
                                    <button onclick="event.stopPropagation(); editProduct('${c.id}', '${pid}')"><i class="fas fa-edit"></i></button>
                                    <button onclick="event.stopPropagation(); deleteProduct('${c.id}', '${pid}')"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        `;
                    });
                    
                    productsHTML += `
                            <div class="total-amount">‡§ï‡•Å‡§≤: ‚Çπ${total}</div>
                        </div>
                    `;
                } else {
                    productsHTML = `
                        <div class="products-section">
                            <div class="text-center py-3" style="color: #64748b;">
                                <i class="fas fa-box-open" style="font-size: 30px; margin-bottom: 10px; color: #bae6fd;"></i>
                                <p>‡§ï‡•ã‡§à ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§®‡§π‡•Ä‡§Ç</p>
                                <button class="add-product-mini" onclick="event.stopPropagation(); showAddProductModal('${c.id}')">
                                    <i class="fas fa-plus"></i> ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                const card = `
                    <div class="customer-card" data-color="${colorNum}">
                        <div class="customer-header">
                            <div class="customer-avatar">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <div class="customer-info">
                                <div class="customer-name">${displayName}</div>
                                <div class="customer-meta">
                                    <span class="meta-item"><i class="fas fa-phone"></i> ${displayPhone}</span>
                                    <span class="due-badge">‚Çπ${c.totalDues || 0}</span>
                                </div>
                            </div>
                        </div>
                        <div class="customer-actions">
                            <button class="action-btn whatsapp-btn" onclick="event.stopPropagation(); sendWhatsApp('${c.id}')">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </button>
                            <button class="action-btn edit-btn" onclick="event.stopPropagation(); editCustomer('${c.id}')">
                                <i class="fas fa-edit"></i> ‡§è‡§°‡§ø‡§ü
                            </button>
                            <button class="action-btn delete-btn" onclick="event.stopPropagation(); deleteCustomer('${c.id}')">
                                <i class="fas fa-trash"></i> ‡§°‡§ø‡§≤‡•Ä‡§ü
                            </button>
                        </div>
                        ${productsHTML}
                    </div>
                `;
                
                container.innerHTML += card;
            });
        }

        // WhatsApp Function
        function sendWhatsApp(id) {
            const c = allCustomers.find(c => c.id === id);
            if (!c?.phone) {
                showMessage('‚ùå ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à', 'error');
                return;
            }
            
            let phone = c.phone.replace(/\D/g, '');
            if (phone.length === 10) phone = '91' + phone;
            
            let msg = `üè™ ‡§∂‡•ç‡§∞‡•Ä ‡§¨‡§æ‡§≤‡§æ‡§ú‡•Ä ‡§µ‡•á‡§∞‡§æ‡§Ø‡§ü‡•Ä ‡§∏‡•ç‡§ü‡•ã‡§∞, ‡§ñ‡•Ç‡§°‡§º\n\n`;
            msg += `üë§ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï: ${c.name}\n`;
            msg += `üìû ‡§´‡•ã‡§®: ${c.phone}\n`;
            msg += `üí∞ ‡§¨‡§ï‡§æ‡§Ø‡§æ: ‚Çπ${c.totalDues || 0}\n\n`;
            
            if (c.products && Object.keys(c.products).length > 0) {
                msg += `üì¶ ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•Ä:\n`;
                let i = 1;
                Object.values(c.products).forEach(p => {
                    msg += `${i}. ${p.name} - ‚Çπ${p.price} (${formatDateHindi(p.date)})\n`;
                    i++;
                });
            }
            
            msg += `\nüôè ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ú‡§≤‡•ç‡§¶ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§\n‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè`;
            
            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        // Customer CRUD
        function showAddCustomerModal() {
            document.getElementById('customerModalTitle').innerHTML = '<i class="fas fa-user-plus"></i> ‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï';
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerItem').value = '';
            document.getElementById('customerPrice').value = '';
            document.getElementById('customerDate').value = new Date().toISOString().split('T')[0];
            currentCustomerId = null;
            new bootstrap.Modal(document.getElementById('customerModal')).show();
        }

        function editCustomer(id) {
            const c = allCustomers.find(c => c.id === id);
            if (!c) return;
            
            document.getElementById('customerModalTitle').innerHTML = '<i class="fas fa-user-edit"></i> ‡§è‡§°‡§ø‡§ü ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï';
            document.getElementById('customerName').value = c.name || '';
            document.getElementById('customerPhone').value = c.phone || '';
            document.getElementById('customerItem').value = '';
            document.getElementById('customerPrice').value = '';
            document.getElementById('customerDate').value = new Date().toISOString().split('T')[0];
            currentCustomerId = id;
            new bootstrap.Modal(document.getElementById('customerModal')).show();
        }

        function saveCustomer() {
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const item = document.getElementById('customerItem').value.trim();
            const price = document.getElementById('customerPrice').value;
            const date = document.getElementById('customerDate').value;

            if (!name) {
                showMessage('‚ùå ‡§®‡§æ‡§Æ ‡§°‡§æ‡§≤‡•á‡§Ç', 'error');
                return;
            }

            if (!phone) {
                showMessage('‚ùå ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç', 'error');
                return;
            }

            const data = { name, phone, timestamp: Date.now() };

            if (currentCustomerId) {
                // Edit mode - only update name and phone
                database.ref('customers/' + currentCustomerId).update(data)
                    .then(() => {
                        bootstrap.Modal.getInstance(document.getElementById('customerModal')).hide();
                        showSuccess('‚úÖ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ');
                    })
                    .catch(error => showMessage('‚ùå ‡§ó‡§≤‡§§‡•Ä: ' + error.message, 'error'));
            } else {
                // New customer
                database.ref('customers').push(data)
                    .then(ref => {
                        if (price && item) {
                            return database.ref('customers/' + ref.key + '/products').push({
                                name: item, price: Number(price), date, timestamp: Date.now()
                            });
                        }
                    })
                    .then(() => {
                        bootstrap.Modal.getInstance(document.getElementById('customerModal')).hide();
                        showSuccess('‚úÖ ‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ú‡•Å‡§°‡§º ‡§ó‡§Ø‡§æ');
                    })
                    .catch(error => showMessage('‚ùå ‡§ó‡§≤‡§§‡•Ä: ' + error.message, 'error'));
            }
        }

        function deleteCustomer(id) {
            const customer = allCustomers.find(c => c.id === id);
            if (!customer) return;
            
            if (confirm(`‚ö†Ô∏è "${customer.name}" ‡§ï‡•ã ‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§≠‡•á‡§ú‡•á‡§Ç?`)) {
                const deletedData = {
                    ...customer,
                    deletedAt: new Date().toISOString(),
                    deletedAtTimestamp: Date.now(),
                    originalId: id
                };
                
                const deletedId = `deleted_${Date.now()}`;
                
                database.ref('deleted_customers/' + deletedId).set(deletedData)
                    .then(() => database.ref('customers/' + id).remove())
                    .then(() => {
                        loadDeletedCount();
                        showSuccess(`‚úÖ "${customer.name}" ‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§≠‡•á‡§ú ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ`);
                    })
                    .catch(error => showMessage('‚ùå ‡§ó‡§≤‡§§‡•Ä: ' + error.message, 'error'));
            }
        }

        // Product Functions
        function showAddProductModal(customerId) {
            currentCustomerId = customerId;
            document.getElementById('productName').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productDate').value = new Date().toISOString().split('T')[0];
            new bootstrap.Modal(document.getElementById('productModal')).show();
        }

        function saveProduct() {
            if (!currentCustomerId) return;
            
            const name = document.getElementById('productName').value.trim();
            const price = document.getElementById('productPrice').value;
            const date = document.getElementById('productDate').value;

            if (!name || !price) {
                showMessage('‚ùå ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§ï‡•Ä‡§Æ‡§§ ‡§°‡§æ‡§≤‡•á‡§Ç', 'error');
                return;
            }

            database.ref('customers/' + currentCustomerId + '/products').push({ 
                name, price: Number(price), date, timestamp: Date.now()
            })
            .then(() => {
                bootstrap.Modal.getInstance(document.getElementById('productModal')).hide();
                showSuccess('‚úÖ ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ú‡•Å‡§°‡§º ‡§ó‡§Ø‡§æ');
            })
            .catch(error => showMessage('‚ùå ‡§ó‡§≤‡§§‡•Ä: ' + error.message, 'error'));
        }

        function editProduct(customerId, productId) {
            const customer = allCustomers.find(c => c.id === customerId);
            if (!customer?.products) return;
            
            const p = customer.products[productId];
            const newName = prompt('‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ï‡§æ ‡§®‡§æ‡§Æ:', p.name);
            const newPrice = prompt('‡§ï‡•Ä‡§Æ‡§§:', p.price);
            
            if (newName && newPrice) {
                database.ref(`customers/${customerId}/products/${productId}`).update({
                    name: newName, price: Number(newPrice), timestamp: Date.now()
                })
                .then(() => {
                    showSuccess('‚úÖ ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ');
                })
                .catch(error => showMessage('‚ùå ‡§ó‡§≤‡§§‡•Ä: ' + error.message, 'error'));
            }
        }

        function deleteProduct(customerId, productId) {
            if (confirm('‚ö†Ô∏è ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡•á‡§Ç?')) {
                database.ref(`customers/${customerId}/products/${productId}`).remove()
                    .then(() => {
                        showSuccess('‚úÖ ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ');
                    })
                    .catch(error => showMessage('‚ùå ‡§ó‡§≤‡§§‡•Ä: ' + error.message, 'error'));
            }
        }

        // Messages
        function showMessage(msg, type) {
            const container = document.getElementById('messageContainer');
            container.innerHTML = `<div class="message ${type}-message">${msg}</div>`;
            setTimeout(() => container.innerHTML = '', 5000);
        }

        function showSuccess(msg) {
            const toast = document.createElement('div');
            toast.style.cssText = 'position:fixed; bottom:20px; right:20px; left:20px; background:white; color:#0284c7; padding:16px 20px; border-radius:60px; box-shadow:0 10px 30px rgba(0,0,0,0.1); display:flex; align-items:center; gap:12px; z-index:9999; border-left:4px solid #0284c7; max-width:400px; margin:0 auto;';
            toast.innerHTML = `<i class="fas fa-check-circle" style="color:#0284c7;"></i> ${msg}`;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Security: Disable right click
        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>
